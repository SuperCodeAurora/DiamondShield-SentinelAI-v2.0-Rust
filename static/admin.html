<!DOCTYPE html>
<html>
<head>
    <title>DiamondShield Command Center</title>
    <style>
        body { background: #0d1117; color: #c9d1d9; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 20px; }
        h1 { color: #58a6ff; border-bottom: 1px solid #30363d; padding-bottom: 10px; }
        .tabs { display: flex; gap: 20px; margin-bottom: 20px; }
        .tab { cursor: pointer; padding: 10px 20px; background: #21262d; border-radius: 6px; font-weight: bold; }
        .tab.active { background: #1f6feb; color: white; }
        
        table { width: 100%; border-collapse: collapse; background: #161b22; border-radius: 6px; overflow: hidden; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #30363d; }
        th { background: #21262d; color: #8b949e; }
        tr:hover { background: #21262d; }
        
        .btn { padding: 5px 10px; border-radius: 4px; border: none; cursor: pointer; font-weight: bold; }
        .btn-allow { background: #238636; color: white; }
        .btn-block { background: #da3633; color: white; }
        
        .badge { padding: 2px 6px; border-radius: 10px; font-size: 12px; }
        .badge-blocked { background: rgba(218, 54, 51, 0.2); color: #f85149; }
        .badge-allowed { background: rgba(35, 134, 54, 0.2); color: #3fb950; }
    </style>
</head>
<body>

    <h1>üõ°Ô∏è DiamondShield Command Center</h1>

    <div class="tabs">
        <div class="tab active" onclick="showTab('alerts')">‚ö†Ô∏è Alerts (Action Needed)</div>
        <div class="tab" onclick="showTab('history')">üìú Attack History</div>
    </div>

    <div id="alerts-view">
        <p>Recent high-threat blocks pending review.</p>
        <table id="alerts-table">
            <thead><tr><th>Time</th><th>IP</th><th>Reason</th><th>Payload</th><th>Decision</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>

    <div id="history-view" style="display:none">
        <p>Full audit log of all intercepted threats.</p>
        <table id="history-table">
            <thead><tr><th>Time</th><th>IP</th><th>Reason</th><th>Payload</th><th>Status</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        let logs = [];

        async function fetchLogs() {
            const res = await fetch('/api/history');
            logs = await res.json();
            render();
        }

        async function allowIP(ip) {
            if(!confirm(`Allow all future traffic from ${ip}?`)) return;
            await fetch('/api/allow', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ ip })
            });
            alert(`${ip} is now Whitelisted.`);
            fetchLogs(); // Refresh
        }

        function render() {
            const alertTbody = document.querySelector('#alerts-table tbody');
            const historyTbody = document.querySelector('#history-table tbody');
            alertTbody.innerHTML = '';
            historyTbody.innerHTML = '';

            // Reverse logs to show newest first
            const recentLogs = [...logs].reverse();

            recentLogs.forEach(log => {
                // Populate History
                historyTbody.innerHTML += `
                    <tr>
                        <td>${new Date(log.timestamp).toLocaleTimeString()}</td>
                        <td>${log.ip}</td>
                        <td>${log.reason}</td>
                        <td style="font-family:monospace; color:#a5d6ff">${log.payload}</td>
                        <td><span class="badge badge-blocked">${log.status}</span></td>
                    </tr>
                `;

                // Populate Alerts (Only "Blocked" items)
                if(log.status === "Blocked") {
                    alertTbody.innerHTML += `
                        <tr>
                            <td>${new Date(log.timestamp).toLocaleTimeString()}</td>
                            <td>${log.ip}</td>
                            <td>${log.reason}</td>
                            <td style="font-family:monospace; color:#a5d6ff">${log.payload}</td>
                            <td>
                                <button class="btn btn-allow" onclick="allowIP('${log.ip}')">‚úÖ Allow</button>
                                <button class="btn btn-block" onclick="this.parentElement.parentElement.remove()">‚ùå Dismiss</button>
                            </td>
                        </tr>
                    `;
                }
            });
        }

        function showTab(tab) {
            document.getElementById('alerts-view').style.display = tab === 'alerts' ? 'block' : 'none';
            document.getElementById('history-view').style.display = tab === 'history' ? 'block' : 'none';
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Auto-refresh every 2 seconds
        setInterval(fetchLogs, 2000);
        fetchLogs();
    </script>
</body>
</html>
